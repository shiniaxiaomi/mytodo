<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>jQuery UI 拖动（Draggable） + 排序（Sortable）</title>
    <link
      rel="stylesheet"
      href="https://cdn.bootcss.com/jqueryui/1.12.1/jquery-ui.min.css"
    />
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <!--  jquery.ui.touch-punch的本地资源引用-->
    <script src="https://cdn.bootcss.com/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>

    <style>
      ul {
        list-style-type: none;
        margin: 0;
        padding: 0;
        margin-bottom: 10px;
      }

      li {
        margin: 5px;
        padding: 5px;
        width: 150px;
      }
    </style>
  </head>

  <body>
    <!-- <ul>
      <li id="draggable" class="ui-state-highlight">请拖拽我</li>
    </ul> -->

    <button onclick="add()">添加</button>

    <ul id="sortable">
      <!-- <li class="ui-state-default">Item 1</li>
        <li class="ui-state-default">Item 2</li>
        <li class="ui-state-default">Item 3</li>
        <li class="ui-state-default">Item 4</li>
        <li class="ui-state-default">Item 5</li> -->
    </ul>
  </body>
</html>
<script>
  var isMoving = false;
  var arr = ["1", "2"];
  var ul = undefined;
  $(function() {
    ul = $("ul").eq(0);
    arr.map(item => {
    //   ul.append('<li class="ui-state-default">' + item + "</li>");
        createElement(item);
    });

    $("#sortable").sortable({
      revert: true,
      start: function(event, ui) {
        //当开始排序时触发
        // alert("this is start");
        // console.log("this is start")
        isMoving=true;
      },
      stop: function(event, ui) {
        //排序动作结束时触发此事件。
        //alert("this is stop");
        // console.log("this is stop")
        isMoving=false;
      }
    });

    // $("#draggable").draggable({
    //     connectToSortable: "#sortable",
    //     helper: "clone",
    //     revert: "invalid"
    // });
    $("ul, li").disableSelection();
  });
  var touchValue = { x: 5, y: 5, sx: 0, sy: 0, ex: 0, ey: 0 }; //initialize the touch values
  window.addEventListener("touchstart", function() {
    console.log("touchstart");
    var event = event || window.event;
    touchValue.sx = event.targetTouches[0].pageX;
    touchValue.sy = event.targetTouches[0].pageY;
    touchValue.ex = touchValue.sx;
    touchValue.ey = touchValue.sy;
  });
  window.addEventListener("touchmove", function(event) {
    var event = event || window.event;
    event.preventDefault();
    touchValue.ex = event.targetTouches[0].pageX;
    touchValue.ey = event.targetTouches[0].pageY;
    console.log("touchmove");
  });
  window.addEventListener("touchend", function(event) {
    var event = event || window.event;
    var changeX = touchValue.ex - touchValue.sx;
    var changeY = touchValue.ey - touchValue.sy;
    //console.log("X:"+changeX+" Y:"+changeY);
    window.getSelection
      ? window.getSelection().removeAllRanges()
      : document.selection.empty();
    console.log("touchend");
  });

  function add() {
    var buff = prompt("添加todo");
    createElement(buff);
    // var li = $('<li class="ui-state-default">' + buff + "</li>");
    // li.click(function(event) {
    //   if (isMoving) return;
    //   this.innerText = prompt("添加todo", this.innerText);
    //   event.preventDefault();
    // });
    // ul.append(li);
  }


//创建一个todo
  function createElement(str){
    var li = $('<li class="ui-state-default">' + str + "</li>");
    li.click(function(event) {
      if (isMoving) return;
      this.innerText = prompt("添加todo", this.innerText);
      event.preventDefault();
    });
    ul.append(li);
  }
</script>
